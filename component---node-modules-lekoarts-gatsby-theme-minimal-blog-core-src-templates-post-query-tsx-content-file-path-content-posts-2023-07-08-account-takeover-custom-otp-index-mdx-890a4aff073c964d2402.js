"use strict";(self.webpackChunkminimal_blog=self.webpackChunkminimal_blog||[]).push([[931],{6123:function(e,t,n){n.r(t),n.d(t,{Head:function(){return o.p},default:function(){return s}});var a=n(6540),i=n(8453);function l(e){const t=Object.assign({p:"p",em:"em",br:"br",code:"code",ul:"ul",li:"li",strong:"strong",pre:"pre",a:"a"},(0,i.RP)(),e.components);return a.createElement(a.Fragment,null,a.createElement(t.p,null,a.createElement(t.em,null,"Me - My Favorite number is 1337. System, can you please generate this OTP for all the users?",a.createElement(t.br),"\n","System - No!! However, since you insist, here you go!")),"\n",a.createElement(t.p,null,"This is what we were able to do on ",a.createElement(t.code,null,"redacted.com"),", which resulted in a zero-click account takeover. All we needed to know was the user's email address. However, there is a catch! We will discuss this later."),"\n",a.createElement(t.p,null,"To provide a brief description of the login functionality on ",a.createElement(t.code,null,"redacted.com"),", the application requires the user's email address. Once the email is provided, an OTP (One-Time Password) is generated and sent to the email address. The user is then required to verify this OTP. The application behaves as follows:"),"\n",a.createElement(t.ul,null,"\n",a.createElement(t.li,null,"The OTP is a 4-digit code. (Can I bruteforce it? Maybe, if we are not rate limited.)"),"\n",a.createElement(t.li,null,"The OTP expires after 10 minutes or is invalidated after 3 incorrect attempts."),"\n",a.createElement(t.li,null,"Before requesting a new OTP, the user must validate a captcha."),"\n",a.createElement(t.li,null,"The OTP generation will cease after 5 new OTP requests."),"\n"),"\n",a.createElement(t.p,null,"Quite a protection here, right? Obviously not! We will now discuss in detail every step taken here to bypass these protections (or possibly explore an alternative approach)."),"\n",a.createElement(t.p,null,"Since ",a.createElement(t.em,null,a.createElement(t.strong,null,"“The OTP expires after 10 minutes or is invalidated after 3 incorrect attempts.”")),", it is highly unlikely for us to guess a correct OTP within 3 attempts due to the low probability (3 out of 10,000)."),"\n",a.createElement(t.p,null,"There's another point that we mentioned earlier - ",a.createElement(t.em,null,a.createElement(t.strong,null,"“The OTP generation will cease after 5 new OTP requests.”"))," This is an area where we can exploit. If we can bypass this restriction and make the application generate an unlimited number of OTPs, we can probably force the application to spit out an OTP of our choice. Since the OTPs are just 4 digits long, it is theoretically and may be practically possible to achieve so. This is what we did to take over someone’s account."),"\n",a.createElement(t.p,null,"Before we can generate OTPs, we have another problem - ",a.createElement(t.em,null,a.createElement(t.strong,null,"“Before requesting a new OTP, the user must validate a captcha.”"))," This is the following request:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-none",highlight:"3,5"},'POST /XXX/XXXXX/get-captcha HTTP/2\nHost: redacted.com\nReq-Id: f20d1adb-b771-4178-829d-397eeff2bc4c\nClient-Id: XXXXX\nDevice-Id: da7286e9-5dca-430f-819c-06957b10364c\nClient-Data: XXXXXXXXX\nTimestamp: 1685800008437\nAuthorization: Bearer\nVersion-Id: 1\nContent-Type: application/json; charset=utf-8\nContent-Length: 182\nAccept-Encoding: gzip, deflate\nUser-Agent: XXXXX\n\n{"clientId":"XXXXXXXX"}\n')),"\n",a.createElement(t.p,null,"This API automatically generates captcha codes based on the values of ",a.createElement(t.code,null,"Req-Id")," and ",a.createElement(t.code,null,"Device-Id"),". However, this API was also subject to rate limiting. Further investigation revealed that by sending different values in the ",a.createElement(t.code,null,"Req-Id")," and ",a.createElement(t.code,null,"Device-Id")," headers, we could bypass the rate limiting and generate an unlimited number of captcha codes automatically, without requiring any user interaction."),"\n",a.createElement(t.p,null,"The next step is to request a new OTP. This is the following request:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,{className:"language-none",highlight:"3,5"},'POST /XXX/XXXXX/get-code HTTP/2\nHost: redacted.com\nReq-Id: f20d1adb-b771-4178-829d-397eeff2bc4c\nClient-Id: XXXXX\nDevice-Id: da7286e9-5dca-430f-819c-06957b10364c\nClient-Data: XXXXXXXXX\nTimestamp: 1685800008437\nAuthorization: Bearer\nVersion-Id: 1\nContent-Type: application/json; charset=utf-8\nContent-Length: 182\nAccept-Encoding: gzip, deflate\nUser-Agent: okhttp/4.10.0\n\n{"captchaCode":"XXXXXX","clientId":"XXXXXXXX","email":"contact@bhavukjain.com"}\n')),"\n",a.createElement(t.p,null,"As guessed correctly, using different values for ",a.createElement(t.code,null,"Req-Id")," and ",a.createElement(t.code,null,"Device-Id")," allows us to bypass the rate limiting here as well. However, we encounter a limitation after making five requests, as stated in the description: ",a.createElement(t.em,null,a.createElement(t.strong,null,'"The OTP generation will cease after 5 new OTP requests."'))," The backend system verifies whether the application has generated five distinct OTPs for an email or not. Once the five OTPs have been generated, we are blocked from generating new OTPs for that email for a period of 24 hours."),"\n",a.createElement(t.p,null,"This restriction was circumvented by manipulating the email addresses with a mix of upper and lower case letters. For instance, we made five requests for ",a.createElement(t.code,null,"contact@bhavukjain.com"),", another five requests for ",a.createElement(t.code,null,"contact@BHAVUKJAIN.com"),", and five more requests for ",a.createElement(t.code,null,"contact@bhavukjain.cOm"),". By employing this method, we were able to generate a significant number of OTPs necessary for the attack. Consequently, we could continue forcing the application to generate OTPs until we reached the desired code, such as 1337, by continuously utilizing the verify OTP API."),"\n",a.createElement(t.p,null,"All of these steps were automated, and it took approximately 10-15 minutes (sometimes as little as 2 minutes) for the backend to generate the OTP of 1337, thereby granting us complete control over the entire account."),"\n",a.createElement(t.p,null,"Remember, I mentioned earlier that there is a catch? The only limitation of this attack is that the email address should have a sufficient number of letters; otherwise, we won't be able to create a large list of emails. But usually, this is not the case. For example, if the email is something like ",a.createElement(t.a,{href:"mailto:1337@gmail.com"},"1337@gmail.com"),", we won't be able to generate a substantial number of unique email variations. Consequently, it would be practically impossible to generate an OTP of our choice in such cases."),"\n",a.createElement(t.p,null,"In conclusion, the login functionality on ",a.createElement(t.code,null,"redacted.com")," exhibited vulnerabilities that allowed for a zero-click account takeover. By exploiting weaknesses in the OTP generation process, rate limiting, and captcha validation, we were able to manipulate the system and gain unauthorized access. While these security flaws provide a pathway to compromise user accounts, it is crucial for developers and organizations to learn from such incidents and continually strengthen their authentication mechanisms. Robust safeguards, including stronger rate limiting, enhanced captcha validation, and improved OTP generation algorithms, can significantly enhance the security of user login systems. By staying vigilant and implementing proactive security measures, we can help safeguard user data and protect against similar exploits in the future."))}var r=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,i.RP)(),e.components);return t?a.createElement(t,e,a.createElement(l,e)):l(e)},o=n(8865);function s(e){return a.createElement(o.A,e,a.createElement(r,e))}o.A}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-2023-07-08-account-takeover-custom-otp-index-mdx-890a4aff073c964d2402.js.map