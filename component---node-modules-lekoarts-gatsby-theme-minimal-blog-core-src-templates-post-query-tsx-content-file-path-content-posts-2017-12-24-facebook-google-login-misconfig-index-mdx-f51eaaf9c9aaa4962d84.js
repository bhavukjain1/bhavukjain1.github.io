"use strict";(self.webpackChunkminimal_blog=self.webpackChunkminimal_blog||[]).push([[53],{2547:function(e,t,n){n.r(t),n.d(t,{Head:function(){return r.p},default:function(){return c}});var o=n(6540),a=n(8453),l=n(8373);function s(e){const t=Object.assign({p:"p",strong:"strong",ul:"ul",li:"li",pre:"pre",code:"code"},(0,a.RP)(),e.components);return o.createElement(o.Fragment,null,o.createElement(t.p,null,"The mobile applications that uses Login with Facebook or Login with Google, I’ve found more than 70% of them suffers a misconfiguration in validating the tokens at their backend which leads to account takeover."),"\n",o.createElement(t.p,null,o.createElement(t.strong,null,"What’s the common issue in Facebook and Google Login?")),"\n",o.createElement(t.p,null,"The access tokens generated by Facebook or ID tokens generated by Google are not validated properly at the backend. These tokens are not validated if they are generated from their own app or not. This means any malicious app can takeover the user accounts on the misconfigured targeted app. Let’s discuss the technical part of both Facebook and Google login."),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Facebook Login"),"\n"),"\n",o.createElement(t.p,null,"A mobile app generally uses Facebook SDK for login into the app. Now when a user login with Facebook, Facebook generates an access token which is then sent to the backend for token validation.\nThis is how an app generally validates the token:"),"\n",o.createElement(t.pre,null,o.createElement(t.code,null,"https://graph.facebook.com/v2.10/me?fields=verified,email,name,id&access_token=XXXXXXXXXXXXXXX\n")),"\n",o.createElement(t.p,null,"The response of this token validation url gives this:"),"\n",o.createElement(t.pre,null,o.createElement(t.code,null,'{\n  "verified": true,\n  "email": “XXXXXX@gmail.com”,\n  "name": "Bhavuk Jain",\n  "id": “XXXXXX”\n}\n')),"\n",o.createElement(t.p,null,"The parameter ",o.createElement(t.code,null,"verified")," shows it as true. This parameter ",o.createElement(t.code,null,"verified")," is highly misinterpreted. The true value means the token is valid but this doesn’t mean the access token is generated by the target app or not and therefore allows a malicious app to gain access to the target's app user account using the access token which was generated for the malicious app."),"\n",o.createElement(t.p,null,o.createElement(t.strong,null,"The proper way of authenticating the access token as mentioned by Facebook deep inside the documentation is this:")),"\n",o.createElement(t.p,null,"Creating a HMAC 256 using access token and app secret and then sending it to the API will help in preventing this misconfiguration:"),"\n",o.createElement(t.pre,null,o.createElement(t.code,null,"https://graph.facebook.com/v2.10/me?fields=verified,email,name,id&access_token=XXXXXXXXXXXXXXX&appsecret_proof=XXXXXXXXXXXXX\n")),"\n",o.createElement(t.p,null,"This is the correct way of validating the access tokens."),"\n",o.createElement(t.p,null,"More info here: ",o.createElement(l.A,{text:"https://developers.facebook.com/docs/graph-api/securing-requests",url:"https://developers.facebook.com/docs/graph-api/securing-requests"})),"\n",o.createElement(t.p,null,"There’s one more way of validating the access token. Just compare the app id in the response with one of the whitelisted app ids. ",o.createElement(t.strong,null,"(Not recommended though)"),"."),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Similarly in Google Login, Google generates an ID token and this is how developers generally validates it:"),"\n"),"\n",o.createElement(t.pre,null,o.createElement(t.code,null,"https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjkzOXXXXXXXXXX\n")),"\n",o.createElement(t.p,null,"Response of this API:"),"\n",o.createElement(t.pre,null,o.createElement(t.code,null,'{\n "azp": “XXXXX.apps.googleusercontent.com",\n "aud": “XXXXX.apps.googleusercontent.com",\n "sub": "1000017729808XXXXXX”,\n "email": “XXXXX@gmail.com”,\n "email_verified": "true",\n "at_hash": "GfILIXhViTXXXXXXXXXX",\n "iss": "https://accounts.google.com",\n "iat": “XXXXX”,\n "exp": “XXXXXX”,\n "name": "Bhavuk Jain",\n "picture": "https://lh4.googleusercontent.com/-P3L8oCL4OhM/AAAAAAAAAAI/AAAAAAAAAMs/1ia6G7mh0lg/s96-c/photo.jpg",\n "given_name": "Bhavuk",\n "family_name": "Jain",\n "locale": "en",\n "alg": "RS256",\n "kid": “XXXXX”\n}\n')),"\n",o.createElement(t.p,null,"Most of the times, the developers forget to compare the value of ",o.createElement(t.code,null,"aud")," with the whitelisted ones. The ",o.createElement(t.code,null,"aud")," represents the app id that has generated this token. This should be validated if the ",o.createElement(t.code,null,"aud")," value belongs to the known apps or not."),"\n",o.createElement(t.p,null,o.createElement(t.strong,null,"Proof of Concept/Impact of these Misconfigurations")),"\n",o.createElement(t.p,null,"Any malicious app can takeover the user accounts of the misconfigured targeted app, given that the user has accessed the malicious app and logged in with either Facebook or Google. For example, let’s say there is a competitor of Uber, “XYZ” app. There’s a high probability that a user is common to both Uber and XYZ. If XYZ app has a misconfiguration either with Facebook/Google Login, Uber can access the user accounts of XYZ’s app using the access tokens of their own customers."),"\n",o.createElement(t.p,null,o.createElement(t.strong,null,"How this issue could be prevented solely by Facebook/Google:")),"\n",o.createElement(t.p,null,"In the access token validation APIs, if they make it mandatory to pass secret token in order to process the access token and fetch user data, all the apps will get secured automatically. I also raised this issue to Facebook but they don’t consider this as an issue because it’s the developer’s job to properly authenticate the tokens."),"\n",o.createElement(t.p,null,"A few apps in which I found this misconfiguration includes Instacart, Stackoverflow, GroupMe by Microsoft, Smartsheet, Waze by Google, Boozt Fashion etc. Most of the companies had take this issue as P1 and paid accordingly. But there are a few applications that don’t consider this as an issue and the vulnerability still exists which includes Snapdeal, Freecharge, 9Gag, Udemy."),"\n",o.createElement(t.p,null,"There are still hundreds of applications that suffer from this misconfiguration. If you found one, give me a high five on ",o.createElement(l.A,{text:"Twitter",url:"https://twitter.com/bhavukjain1"})," or just leave a comment here."))}var i=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,a.RP)(),e.components);return t?o.createElement(t,e,o.createElement(s,e)):s(e)},r=n(8865);function c(e){return o.createElement(r.A,e,o.createElement(i,e))}r.A},8373:function(e,t,n){var o=n(6540),a=n(6981);t.A=e=>{let{text:t,url:n}=e;const{0:l,1:s}=(0,o.useState)(!1),i=l?"underline":"none",{0:r,1:c}=(0,o.useState)("");(0,o.useEffect)((()=>{const e=e=>{const t=localStorage.getItem("theme-ui-color-mode");t&&(console.log(t),c(t))};window.addEventListener("click",e);const t=localStorage.getItem("theme-ui-color-mode");return t&&c(t),()=>{window.removeEventListener("click",e)}}),[]);const h={color:"dark"===r?a.Ay.colors.purple[5]:a.Ay.colors.purple[7],textDecoration:i};return o.createElement("a",{style:h,href:n,target:"_blank",rel:"nofollow noopener noreferrer",onMouseEnter:()=>{s(!0)},onMouseLeave:()=>{s(!1)}},t)}}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-2017-12-24-facebook-google-login-misconfig-index-mdx-f51eaaf9c9aaa4962d84.js.map