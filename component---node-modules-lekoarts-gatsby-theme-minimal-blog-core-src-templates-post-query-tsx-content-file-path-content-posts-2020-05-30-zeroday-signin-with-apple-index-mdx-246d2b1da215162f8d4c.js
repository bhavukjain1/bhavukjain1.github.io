"use strict";(self.webpackChunkminimal_blog=self.webpackChunkminimal_blog||[]).push([[395],{1736:function(e,t,n){n.r(t),n.d(t,{Head:function(){return o.p},default:function(){return c}});var a=n(6540),l=n(8453);function i(e){const t=Object.assign({img:"img",p:"p",code:"code",strong:"strong",blockquote:"blockquote",pre:"pre"},(0,l.RP)(),e.components);return a.createElement(a.Fragment,null,a.createElement(t.img,{src:"https://ik.imagekit.io/dzhosd8qx/siwa.png?updatedAt=1689658397671",alt:"image"}),"\n",a.createElement(t.p,null,"What if I say, your Email ID is all I need to takeover your account on your favorite website or an app. Sounds scary, right? This is what a bug in ",a.createElement(t.code,null,"Sign in with Apple")," allowed me to do."),"\n",a.createElement(t.p,null,"In the month of April, I found a zero-day in ",a.createElement(t.code,null,"Sign in with Apple")," that affected third-party applications which were using it and didn't implement their own additional security measures. This bug could have resulted in a ",a.createElement(t.strong,null,"full account takeover of user accounts")," on that third party application irrespective of a victim having a valid Apple ID or not."),"\n",a.createElement(t.blockquote,null,"\n",a.createElement(t.p,null,"For this vulnerability, I was paid $100,000 by Apple under their Apple Security Bounty program."),"\n"),"\n",a.createElement(t.p,null,a.createElement(t.strong,null,"Technical Details")),"\n",a.createElement(t.p,null,"The ",a.createElement(t.code,null,"Sign in with Apple")," works similarly to OAuth 2.0. There are two possible ways to authenticate a user by either using a ",a.createElement(t.code,null,"JWT (JSON Web Token)")," or a ",a.createElement(t.code,null,"code")," generated by the Apple server. The code is then used to generate a JWT. The below diagram represents how the JWT creation and validation works."),"\n",a.createElement(t.img,{src:"https://ik.imagekit.io/dzhosd8qx/flow_apple_auth.png?updatedAt=1689658397583",alt:"image"}),"\n",a.createElement(t.p,null,"In the 2nd step, while authorizing, Apple gives an option to a user to either share the Apple Email ID with the 3rd party app or not. If the user decides to hide the Email ID, Apple generates its own user-specific Apple relay Email ID. Depending upon the user selection, after successful authorization, Apple creates a JWT which contains this Email ID which is then used by the 3rd party app to login a user."),"\n",a.createElement(t.p,null,"A decoded JWT's payload looks like this:"),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,'{\n  "iss": "https://appleid.apple.com",\n  "aud": "com.XXXX.weblogin",\n  "exp": 158XXXXXXX,\n  "iat": 158XXXXXXX,\n  "sub": "XXXX.XXXXX.XXXX",\n  "c_hash": "FJXwx9EHQqXXXXXXXX",\n  "email": "contact@bhavukjain.com", // or "XXXXX@privaterelay.appleid.com"\n  "email_verified": "true",\n  "auth_time": 158XXXXXXX,\n  "nonce_supported": true\n}\n')),"\n",a.createElement(t.p,null,a.createElement(t.strong,null,a.createElement(t.strong,null,"BUG"))),"\n",a.createElement(t.p,null,"I found I could request JWTs for any Email ID from Apple and when the signature of these tokens was verified using Appleâ€™s public key, they showed as valid. This means an attacker could forge a JWT by linking any Email ID to it and gaining access to the victim's account."),"\n",a.createElement(t.p,null,"Sample Request (2nd step)"),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,'\nPOST /XXXX/XXXX HTTP/1.1\nHost: appleid.apple.com\n\n{"email":"contact@bhavukjain.com"}\n\n')),"\n",a.createElement(t.p,null,"Here on passing any ",a.createElement(t.code,null,"email"),", Apple generated a valid JWT (id_token) for that particular Email ID."),"\n",a.createElement(t.p,null,"Sample Response"),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,'{\n  "authorization" : {\n    "id_token" : "eyJraWQiOiJlWGF1bm1MIiwiYWxnIjoiUlMyNTYifQ.XXXXX.XXXXX",\n    "grant_code" : "XXX.0.nzr.XXXX",\n    "scope" : [ "name", "email" ]\n  },\n  "authorizedData" : {\n    "userId" : "XXX.XXXXX.XXXX"\n  },\n  "consentRequired" : false\n}\n')),"\n",a.createElement(t.p,null,"The impact of this vulnerability was quite critical as it could have allowed full account takeover. A lot of developers have integrated ",a.createElement(t.code,null,"Sign in with Apple")," since it is mandatory for applications that support other social logins. To name a few that use ",a.createElement(t.code,null,"Sign in with Apple")," - Dropbox, Spotify, Airbnb, Giphy (Now acquired by Facebook). These applications were not tested but could have been vulnerable to a full account takeover if there weren't any other security measures in place while verifying a user."),"\n",a.createElement(t.p,null,"Apple also did an investigation of their logs and determined there was no misuse or account compromise due to this vulnerability."),"\n",a.createElement(t.p,null,"A huge thanks to the Apple Security Team."),"\n",a.createElement(t.p,null,"Thanks for the read, see you in next article :)"))}var r=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,l.RP)(),e.components);return t?a.createElement(t,e,a.createElement(i,e)):i(e)},o=n(8865);function c(e){return a.createElement(o.A,e,a.createElement(r,e))}o.A}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-2020-05-30-zeroday-signin-with-apple-index-mdx-246d2b1da215162f8d4c.js.map